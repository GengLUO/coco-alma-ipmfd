# Hardware masking verification

This directory contains a short tutorial on how to verify a TI-masked implementation of the PRINCE cipher.
It should work out-of-the-box with the provided testbench. If you encounter any problems, feel free to open an issue.

## PRINCE-TI

PRINCE-TI, originally developed by Dusan Bozilov, is a masked implementation of the PRINCE cipher. For this tutorial we have provided a copy of the design in the `design` directory as is, with copyright belonging to the original author and shared with his permission.
For the tutorial, we will synthesize the circuit, generate a trace using test-vectors and then attempt to verify the probing resistance. Below, we only show a brief summary of what you need to do.

## Verification Flow

The verification flow is mostly the same as described in the root directory. However, there are additional steps
you need to perform before you can trace the execution of the circuit. In the following, we only briefly describe
the main steps.

* Synthesise the `top_module_d11` circuit, which is the top module of the PRINCE-TI design. The example saves the netlist in the coco-alma temporary directory.
```bash
python3 path_to/coco-alma/parse.py --log-yosys \
    --top-module top_module_d11 \
    --source path_to/coco-alma/examples/prince_ti/design/*
    --netlist path_to/coco-alma/tmp/circuit.v
```

* Create your own Verilator testbench or use the one we provided to generate a trage. If you use the one we provided the trace is saved at `/tmp/tmp.vcd`. The example below uses the default location of the synthesized `circuit.v`.
```bash
python3 path_to/coco-alma/trace.py \
    --testbench path_to/coco-alma/examples/prince_ti/verilator_tb.cpp \
    --netlist path_to/coco-alma/tmp/circuit.v
```
* Create a labeling file for the PRINCE-TI inputs. We have provided a script that does this:
```bash
python3 generate_labels.py path_to/coco-alma/tmp/labels.txt path_to/my-labels.txt
```
* Run the verification script. In the case of our testbench, replace `path_to/vcd-file-location.vcd` with `tmp/tmp.vcd` since that is where it is generated. Provide the `--trace-stable` argument to assume that the trace generated by the circuit is stable and that no glitching occurs on the control signals.
```bash
python3 verify.py \
    --json path_to/coco-alma/tmp/circuit.json \
    --label path_to/coco-alma/my-labels.txt \
    --vcd path_to/vcd-file-location.vcd \
    --cycles 3 \
    --mode transient \
    --rst-name i_reset \
    --trace-stable
```

You can customize most of the artefact file locations generated during this process and then need to
additionally specify them as command line parameters. For more information on what options are supported,
please see the help menus available through `python parse.py --help` and similar.
